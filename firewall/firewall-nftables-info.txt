üî• nftables ‚Äî —ç—Ç–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∑–∞–º–µ–Ω–∞ iptables


–í–∫–ª—é—á–∏—Ç–µ nftables:

    sudo systemctl enable --now nftables
    sudo nft -f /etc/nftables.conf

–ü—Ä–æ–≤–µ—Ä–∫–∞:

	# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
    sudo systemctl status nftables

    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ nftables
    sudo nft list ruleset

    # –ò–ª–∏ —Å—Ç–∞—Ä—ã–π –¥–æ–±—Ä—ã–π iptables (—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)
    sudo iptables -L


üìç –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤:

    –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥: /etc/nftables.conf
    –°–µ—Ä–≤–∏—Å: systemctl status nftables
    –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞: /usr/lib/systemd/system/nftables.service

üîß –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

    # –ü—Ä–∏–º–µ–Ω–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –∏–∑ —Ñ–∞–π–ª–∞
    sudo nft -f /etc/nftables.conf

    # –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–µ–∫—É—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞
    sudo nft list ruleset

    # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –≤ —Ñ–∞–π–ª
    sudo nft list ruleset > /etc/nftables.conf

    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å —Ñ–∞–π–ª–∞
    sudo nft -c -f /etc/nftables.conf


–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è /etc/nftables.conf –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–µ—Ä–≤–∏—Å:
    sudo systemctl restart nftables
–ò–ª–∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ —Å—Ä–∞–∑—É:
    sudo nft -f /etc/nftables.conf


üîÑ –û—Ç–∫–∞—Ç –¥–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª:

    # –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∞–∑–æ–≤—ã–π –∫–æ–Ω—Ñ–∏–≥
    echo '#!/usr/sbin/nft -f
    flush ruleset
    table inet filter {
        chain input {
            type filter hook input priority 0; policy accept;
        }
        chain forward {
            type filter hook forward priority 0; policy accept;
        }
        chain output {
            type filter hook output priority 0; policy accept;
        }
    }' | sudo tee /etc/nftables.conf

    # –ü—Ä–∏–º–µ–Ω–∏—Ç—å
    sudo nft -f /etc/nftables.conf


–ù–∞—Å—Ç—Ä–æ–π–∫–∞ nftables –≤—Ä—É—á–Ω—É—é (–µ—Å–ª–∏ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç–µ):

    –°–æ–∑–¥–∞–π—Ç–µ /etc/nftables.conf:

    #!/usr/sbin/nft -f

    flush ruleset

    table inet filter {
        chain input {
            type filter hook input priority 0; policy drop;
            
            # –†–∞–∑—Ä–µ—à–∏—Ç—å established/related
            ct state established,related accept
            
            # –†–∞–∑—Ä–µ—à–∏—Ç—å loopback
            iifname "lo" accept
            
            # –†–∞–∑—Ä–µ—à–∏—Ç—å ICMP (ping)
            ip protocol icmp accept
            ip6 nexthdr icmpv6 accept
            
            # –†–∞–∑—Ä–µ—à–∏—Ç—å SSH (–∏–∑–º–µ–Ω–∏—Ç–µ –ø–æ—Ä—Ç –µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
            tcp dport 22 accept
            
            # –†–∞–∑—Ä–µ—à–∏—Ç—å HTTP/HTTPS
            tcp dport {80, 443} accept
            
            # Log rejected packets
            log prefix "nftables denied: " counter drop
        }
        
        chain forward {
            type filter hook forward priority 0; policy drop;
        }
        
        chain output {
            type filter hook output priority 0; policy accept;
        }
    }


–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞:

    # –ó–∞—â–∏—Ç–∞ –æ—Ç brute-force –¥–ª—è SSH
    sudo pacman -S fail2ban
    sudo systemctl enable --now fail2ban

üî• firewalld ‚Äî –ø—Ä–æ—â–µ –≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç nftables –ø—Ä–∞–≤–∏–ª–∞!

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏ –≤–∫–ª—é—á–∏—Ç–µ firewalld (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):

    sudo pacman -S firewalld
    sudo systemctl enable --now firewalld

–ë–∞–∑–æ–≤—ã–µ –∑–æ–Ω—ã (—É–∂–µ –ø—Ä–µ–¥configured –≤ firewalld):

    # –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –∑–æ–Ω—ã
    sudo firewall-cmd --get-active-zones

    # –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–∞–≤–∏–ª–∞
    sudo firewall-cmd --list-all

–î–æ–±–∞–≤—å—Ç–µ —Å–≤–æ–∏ —Å–ª—É–∂–±—ã (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):

    # –†–∞–∑—Ä–µ—à–∏—Ç—å HTTP/HTTPS
    sudo firewall-cmd --permanent --add-service=http
    sudo firewall-cmd --permanent --add-service=https

    # –†–∞–∑—Ä–µ—à–∏—Ç—å SSH (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
    sudo firewall-cmd --permanent --add-service=ssh

    # –ò–ª–∏ –∫–∞—Å—Ç–æ–º–Ω—ã–µ –ø–æ—Ä—Ç—ã
    sudo firewall-cmd --permanent --add-port=8080/tcp

