Инструкция по awk

Основной синтаксис:
awk 'pattern {action}' — общий формат
awk '{print $0}' — напечатать всю строку
awk '{print $1}' — напечатать первое поле

Встроенные переменные:
$0 — вся строка
$1, $2, ... — поля (колонки)
NF — количество полей в строке
NR — номер текущей строки
FNR — номер строки в текущем файле
FS — разделитель полей (по умолчанию пробел/таб)
OFS — разделитель полей на выводе
RS — разделитель строк (по умолчанию \n)
ORS — разделитель строк на выводе
FILENAME — имя текущего файла
ARGC — количество аргументов
ARGV — массив аргументов

Специальные блоки:
BEGIN {} — выполнить перед обработкой входных данных
END {} — выполнить после обработки всех данных

Операторы:
print — вывод
printf — форматированный вывод
next — перейти к следующей строке
exit — завершить выполнение

Функции:
length(string) — длина строки
substr(string, start, length) — подстрока
index(string, substring) — позиция подстроки
split(string, array, separator) — разбить строку в массив
tolower(string) — в нижний регистр
toupper(string) — в верхний регистр
match(string, regexp) — поиск по регулярке
sub(regexp, replacement) — заменить первое вхождение
gsub(regexp, replacement) — заменить все вхождения

Математические функции:
int(x) — целая часть
sqrt(x) — квадратный корень
exp(x) — экспонента
log(x) — натуральный логарифм
sin(x), cos(x), atan2(y, x) — тригонометрия
rand() — случайное число 0-1
srand(x) — установить seed для rand

Арифметика:
+ - * / % — базовые операции
^ — возведение в степень
++ -- — инкремент/декремент

Условия:
== != < <= > >= — сравнения
~ — соответствие регулярному выражению
!~ — несоответствие регулярному выражению
&& || ! — логические операторы

Массивы:
array[index] = value — присвоение
for (i in array) — итерация по индексам
delete array[index] — удаление элемента

Пользовательские функции:
function name(args) {body} — объявление функции

Примеры:
awk '{print $1, $NF}' — первое и последнее поле
awk '{sum+=$1} END{print sum}' — сумма первого поля
awk 'NR%2==1' — нечётные строки
awk '/pattern/' — строки содержащие pattern
awk '$1 > 100' — где первое поле больше 100
awk '{print NR": "$0}' — добавить номера строк
awk -F':' '{print $1}' — использовать : как разделитель
awk -v var=value — передать переменную
awk '{$1=""; print $0}' — удалить первое поле
awk '{print length($0)}' — длина каждой строки

Форматированный вывод:
awk '{printf "%-10s %5d\n", $1, $2}' — форматирование
awk '{print $1 OFS $2}' — использовать OFS

Обработка нескольких файлов:
awk 'FNR==1 {print "--- " FILENAME " ---"} 1' file1 file2 — заголовки для файлов

Агрегация:
awk '{count[$1]++} END{for (i in count) print i, count[i]}' — подсчёт уникальных значений

Более сложные примеры:
awk 'BEGIN{FS=","; OFS="|"} {$1=toupper($1); print}' — обработка CSV
awk 'NR>=10 && NR<=20' — строки 10-20
awk '!seen[$0]++' — удалить дубликаты строк
