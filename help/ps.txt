Инструкция по ps

Форматы вывода:
ps — процессы текущего пользователя в текущем терминале
ps -e или ps -A — все процессы
ps -f или ps -f — полный формат
ps -u пользователь — процессы пользователя
ps -p PID — процесс по PID

Полный список:
ps aux — все процессы в BSD формате
ps -ef — все процессы в System V формате
ps -eF — расширенный формат
ps -ely — длинный формат

BSD формат (без дефиса):
ps aux — стандартный для Linux
ps auxww — полная ширина (не обрезать строки)
ps auxf — в виде дерева
ps auxm — показать потоки

System V формат (с дефисом):
ps -ef — стандартный
ps -eF — с дополнительными полями
ps -ely — длинный список

Поля вывода:
ps -o поле1,поле2,... — пользовательские поля
ps -o pid,cmd,%cpu,%mem — PID, команда, CPU, память

Пользовательские форматы:
ps -e -o pid,uname,pcpu,pmem,comm — стандартный набор
ps -e -o pid,comm,args — PID, короткая команда, полная командная строка

Примеры полей:
pid — ID процесса
ppid — ID родительского процесса
user или uname — пользователь
group или gname — группа
%cpu — использование CPU
%mem — использование памяти
rss — резидентный размер (RAM)
vsz — виртуальный размер
tty — контролирующий терминал
stat или state — статус процесса
start или stime — время старта
time — совокупное время CPU
comm или cmd — имя команды
args — командная строка с аргументами
nice — значение nice
pri — приоритет
wchan — ожидание в ядре

Статусы процессов (STAT):
R — запущен (running)
S — спит (sleeping)
D — непрерываемый сон (disk sleep)
Z — зомби (zombie)
T — остановлен (stopped)
t — остановлен отладчиком
X — мертвый (dead)
< — высокий приоритет
N — низкий приоритет
L — страницы заблокированы в памяти
s — лидер сессии
l — многопоточный
+ — foreground процесс группы

Сортировка:
ps aux --sort=-%cpu — по убыванию CPU
ps aux --sort=-%mem — по убыванию памяти
ps aux --sort=pid — по PID
ps aux --sort=start — по времени старта

Фильтрация:
ps -C имя_команды — по имени команды
ps -U UID — по UID пользователя
ps -G GID — по GID группы
ps -t tty — по терминалу
ps --ppid PPID — по родительскому PID
ps --forest — показать дерево процессов

Примеры:
ps — мои процессы в текущем терминале
ps -e — все процессы
ps -ef — все процессы полный формат
ps aux — все процессы BSD формат
ps aux | grep nginx — найти nginx процессы
ps -u root — процессы root
ps -p 1 — процесс с PID 1 (init/systemd)
ps -o pid,ppid,cmd,%cpu,%mem — пользовательские поля
ps -e -o pid,comm,%cpu --sort=-%cpu | head -10 — топ-10 по CPU
ps -e -o pid,comm,%mem --sort=-%mem | head -10 — топ-10 по памяти
ps auxf — дерево процессов
ps -ejH — показать иерархию
ps -eLf — показать потоки (LWP)
ps aux --sort=start_time — по времени запуска
ps -C sshd — все sshd процессы
ps -t pts/0 — процессы в терминале pts/0
ps --ppid 1 — прямые потомки init/systemd
ps -o pid,user,args — с полными аргументами
ps aux --width 200 — ширина 200 символов
ps aux | awk '$8 == "Z"' — найти зомби процессы

Практическое применение:
ps aux | grep -E "(nginx|apache)" — веб-серверы
ps aux | grep defunct — зомби процессы
ps -eo pid,comm,lstart — время запуска процессов
ps -p $$ -o args= — командная строка текущего процесса
ps -o pid,comm --no-headers — только PID и команды без заголовка

Мониторинг:
watch -n 1 'ps aux --sort=-%cpu | head -10' — следить за топом CPU
while true; do ps aux --sort=-%mem | head -5; sleep 2; done — мониторинг памяти

Дерево процессов:
ps axjf или ps -ejH — иерархический вид
pstree — более наглядное дерево

Потоки:
ps -eLf | grep процесс — потоки конкретного процесса
ps -T -p PID — потоки процесса

Информация о текущем процессе:
ps -p $$ — информация о текущем shell
ps -o pid,cmd,stat -p $$ — статус текущего процесса

Формат времени:
ps -eo pid,comm,lstart — время запуска
ps -eo pid,comm,etime — время работы процесса

Разные форматы времени:
etime — прошедшее время [[DD-]hh:]mm:ss
etimes — прошедшее время в секундах
lstart — время запуска

Комбинированные запросы:
ps -e -o pid,uname=USER,%cpu=CPU,%mem=MEM,comm=CMD --sort=-%cpu — с переименованными заголовками

Справка:
ps --help all — полная справка
man ps — документация

Важно:
    ps aux — BSD синтаксис (без дефисов)
    ps -ef — System V синтаксис (с дефисами)
    Linux поддерживает оба синтаксиса
    Для скриптов лучше использовать System V синтаксис
