Инструкция по sed

Основной синтаксис:
sed 's/pattern/replacement/' — замена первого вхождения
sed 's/pattern/replacement/g' — замена всех вхождений
sed 's/pattern/replacement/2' — замена второго вхождения

Адресация строк:
sed 'n command' — применить к строке n
sed '$ command' — применить к последней строке
sed 'n,m command' — применить к строкам с n по m
sed 'n~step command' — применить к каждой step-ной строке начиная с n
sed '/pattern/ command' — применить к строкам, содержащим pattern

Команды редактирования:
sed 'd' — удалить строки
sed 'p' — напечатать строки
sed 'n' — перейти к следующей строке
sed 'q' — выйти
sed '=' — напечатать номер строки
sed 'a\text' — добавить текст после строки
sed 'i\text' — вставить текст перед строкой
sed 'c\text' — заменить строку текстом
sed 'y/abc/ABC/' — трансляция символов (как tr)

Модификаторы:
sed -n — подавить автоматический вывод
sed -i — редактировать файл на месте
sed -i.bak — создать backup с расширением .bak
sed -e 'cmd' -e 'cmd' — несколько команд
sed -f script.sed — выполнить команды из файла
sed -r — использовать расширенные регулярные выражения
sed -E — то же что -r

Специальные символы:
& — совпавшая строка в замене
\1, \2, ... — обратные ссылки на группы
^ — начало строки
$ — конец строки
. — любой символ
* — ноль или больше повторений
\+ — одно или больше повторений
\? — ноль или одно повторение
\{n\} — ровно n повторений
\{n,\} — n или больше повторений
\{n,m\} — от n до m повторений

Примеры замен:
sed 's/foo/bar/' — заменить foo на bar
sed 's/foo/bar/2' — заменить второе foo на bar
sed 's/foo/bar/g' — заменить все foo на bar
sed 's/foo//g' — удалить все foo
sed 's/^ *//' — удалить начальные пробелы
sed 's/ *$//' — удалить конечные пробелы
sed 's/\t/ /g' — заменить табы на 4 пробела

Управление строками:
sed '1d' — удалить первую строку
sed '$d' — удалить последнюю строку
sed '/^$/d' — удалить пустые строки
sed '1,5d' — удалить строки 1-5
sed -n '10,20p' — вывести строки 10-20
sed '=' file | sed 'N;s/\n/\t/' — добавить номера строк с табуляцией

Многострочные операции:
sed 'N;s/\n/ /' — объединить две строки
sed 'H;$!d;x;s/\n/ /g' — объединить все строки

Буферы:
sed 'h' — скопировать в hold buffer
sed 'g' — вставить из hold buffer
sed 'x' — обменять pattern и hold buffers

Ветвления:
sed '/foo/b label; s/bar/baz/; :label' — переход по метке

Примеры с файлами:
sed -i 's/old/new/g' file.txt — заменить в файле
sed -i.bak '/pattern/d' file.txt — удалить строки с созданием backup
