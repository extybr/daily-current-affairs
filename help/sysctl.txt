Инструкция по sysctl

Основные команды:
sysctl -a — показать все параметры ядра
sysctl имя.параметра — показать значение параметра
sysctl -n имя.параметра — показать только значение (без имени)
sysctl -w имя.параметра=значение — изменить параметр временно
sysctl -p [файл] — применить параметры из файла

Файлы конфигурации:
/etc/sysctl.conf — основной файл конфигурации
/etc/sysctl.d/*.conf — дополнительные конфигурации
/usr/lib/sysctl.d/*.conf — системные конфигурации

Сетевые параметры:
net.ipv4.ip_forward — IP форвардинг
net.ipv4.conf.all.forwarding — форвардинг для всех интерфейсов
net.ipv4.tcp_syncookies — TCP SYN cookies защита
net.ipv4.conf.all.rp_filter — reverse path filtering
net.ipv4.icmp_echo_ignore_all — игнорировать ping запросы

Параметры памяти:
vm.swappiness — агрессивность использования swap (0-100)
vm.vfs_cache_pressure — давление на кэш VFS
vm.dirty_ratio — процент памяти для dirty страниц перед sync
vm.dirty_background_ratio — процент для фоновой записи

Безопасность:
kernel.randomize_va_space — ASLR (Address Space Layout Randomization)
kernel.exec-shield — защита от выполнения в стеке
kernel.sysrq — SysRq ключи (0-отключить, 1-включить)

Файловые системы:
fs.file-max — максимальное количество открытых файлов
fs.inotify.max_user_watches — максимальное количество inotify watches

Сетевые настройки TCP:
net.ipv4.tcp_fin_timeout — время ожидания FIN
net.ipv4.tcp_keepalive_time — интервал keepalive
net.ipv4.tcp_max_syn_backlog — максимальная очередь SYN
net.core.somaxconn — максимальная очередь подключений

Примеры:
sysctl net.ipv4.ip_forward — проверить включен ли IP форвардинг
sysctl -w net.ipv4.ip_forward=1 — включить IP форвардинг
sysctl -w vm.swappiness=10 — уменьшить использование swap
sysctl -w kernel.sysrq=1 — включить SysRq
sysctl -p — применить настройки из /etc/sysctl.conf
sysctl -p /etc/sysctl.d/99-custom.conf — применить конкретный файл
sysctl -a | grep tcp — найти все TCP параметры
sysctl -n kernel.hostname — только имя хоста

Постоянные изменения:
    Редактировать /etc/sysctl.conf или файл в /etc/sysctl.d/
    Выполнить sysctl -p для применения

Пример файла конфигурации:
    # /etc/sysctl.d/99-custom.conf
    net.ipv4.ip_forward = 1
    net.ipv4.tcp_syncookies = 1
    vm.swappiness = 10
    kernel.sysrq = 1
    
Параметры ядра:
kernel.msgmax — максимальный размер сообщения IPC
kernel.msgmnb — максимальный размер очереди сообщений
kernel.shmall — общее количество shared memory pages
kernel.shmmax — максимальный размер shared memory segment

Сетевые буферы:
net.core.rmem_max — максимальный размер receive buffer
net.core.wmem_max — максимальный размер send buffer
net.ipv4.tcp_rmem — TCP receive buffer размеры
net.ipv4.tcp_wmem — TCP send buffer размеры

Проверка изменений:
sysctl --system — загрузить все конфигурации
sysctl --load=файл — загрузить конкретный файл

Информация:
sysctl -A — показать все параметры (как -a)
sysctl -N — показать только имена параметров
sysctl -e — игнорировать ошибки при загрузке

Поиск:
sysctl -a | grep -i память — найти параметры связанные с памятью
sysctl -ar "\.max$" — найти параметры заканчивающиеся на .max

Пример оптимизации веб-сервера:
    net.core.somaxconn = 4096
    net.ipv4.tcp_max_syn_backlog = 4096
    net.core.netdev_max_backlog = 5000
    fs.file-max = 100000
    
Безопасность сети:
    net.ipv4.conf.all.accept_source_route = 0
    net.ipv4.conf.default.accept_source_route = 0
    net.ipv4.conf.all.accept_redirects = 0
    net.ipv4.icmp_ignore_bogus_error_responses = 1

Отладка:
sysctl -d параметр — показать описание параметра
sysctl --debug — отладочный режим

Процессы:
kernel.pid_max — максимальный PID
kernel.threads-max — максимальное количество потоков

Важно:
    Изменения через -w временные (до перезагрузки)
    Для постоянных изменений редактируйте конфигурационные файлы
    Перезапуск сети может сбросить сетевые параметры
