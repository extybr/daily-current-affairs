Инструкция по вводу-выводу (redirection)

Основные операторы:
> — перенаправление вывода (перезапись)
>> — перенаправление вывода (добавление)
< — перенаправление ввода
| — pipe (передать вывод одной команды на вход другой)

Стандартные потоки:
0 — stdin (стандартный ввод)
1 — stdout (стандартный вывод)
2 — stderr (стандартная ошибка)

Перенаправление stdout:
команда > файл — stdout в файл (перезаписать)
команда >> файл — stdout в файл (добавить)
команда 1> файл — явное указание stdout

Перенаправление stderr:
команда 2> файл — stderr в файл
команда 2>> файл — stderr добавить в файл

Объединение stdout и stderr:
команда > файл 2>&1 — оба потока в один файл
команда &> файл — сокращенная запись (bash)
команда >& файл — альтернативная запись
команда 2>&1 > файл — НЕ правильно! (stderr в stdout, stdout в файл)

Разделение потоков:
команда > stdout.log 2> stderr.log — раздельное логирование

Перенаправление ввода:
команда < файл — читать stdin из файла
команда << EOF — here-document
команда <<< "строка" — here-string (передать строку)

Pipe (|):
команда1 | команда2 — вывод команда1 → ввод команда2
команда1 | команда2 | команда3 — цепочка пайпов

Специальные файлы:
/dev/null — черная дыра (отбросить вывод)
/dev/zero — источник нулей
/dev/random — случайные данные
/dev/stdin, /dev/stdout, /dev/stderr — стандартные потоки

Примеры:

1. Простой вывод:
    echo "Hello" > file.txt          # создаст/перезапишет file.txt
    echo "World" >> file.txt         # добавит в конец

2. Ошибки и вывод:
    ls /etc/passwd /nonexistent > output.txt 2> errors.txt
    # или
    ls /etc/passwd /nonexistent &> all_output.txt

3. Here-document:
    cat << EOF > config.txt
    server {
        port 8080
        host localhost
    }
    EOF

4. Here-string:
    grep "root" <<< "$(cat /etc/passwd)"
    # или
    wc -l <<< "один два три четыре"

5. Pipe:
    ps aux | grep nginx             # найти nginx процессы
    cat /var/log/syslog | grep error | wc -l  # подсчет ошибок

6. Комбинированный:
    (команда1; команда2) > output.txt 2>&1

7. Подавление вывода:
    команда > /dev/null 2>&1      # полное подавление
    команда 2> /dev/null          # только ошибки

8. Перенаправление в/из файлов:
    sort < unsorted.txt > sorted.txt

9. Множественные файлы:
    cat file1.txt file2.txt > combined.txt

10. Tee (разделение):
    команда | tee file.txt        # и в файл, и на экран
    команда | tee -a file.txt     # добавить в файл

11. Process substitution:
    diff <(sort file1) <(sort file2)    # сравнить отсортированные файлы

12. Перенаправление fd (file descriptor):
    команда 3> file.txt           # запись в дескриптор 3
    команда 4< file.txt           # чтение из дескриптора 4

13. Объединение вывода:
    { команда1; команда2; } > output.txt

14. Перенаправление в переменную:
    output=$(команда)             # захват stdout в переменную

15. Чтение построчно:
    while read line; do
        echo "Строка: $line"
    done < file.txt

16. Стандартные потоки как файлы:
    echo "test" > /dev/stdout     # то же что просто echo "test"
    cat /dev/stdin                # читает с клавиатуры

17. Создание файла:
    > empty_file.txt              # создать пустой файл (0 байт)

18. Добавление с датой:
    date >> log.txt               # добавить текущую дату в лог

19. Перенаправление групп команд:
    { echo "Start"; ls; echo "End"; } > log.txt 2>&1

20. Here-doc с игнорированием табуляции:
    cat <<- EOF
        текст с отступами
        будет без отступов
    EOF

Важные нюансы:
    # Порядок имеет значение!
    команда 2>&1 > file.txt      # stderr → stdout, stdout → file (stderr на экран)
    команда > file.txt 2>&1      # stdout → file, stderr → stdout (оба в file)

    # Скобки создают подпроцесс
    ( команда ) > file.txt       # перенаправление вывода подпроцесса

    # Фигурные скобки выполняют в текущем shell
    { команда; } > file.txt      # перенаправление вывода в текущем shell

Практические примеры:
    # Логирование с временной меткой
    echo "$(date): Запуск скрипта" >> /var/log/myscript.log

    # Отправка ошибок по email
    команда 2>&1 | mail -s "Ошибка" admin@example.com

    # Создание backup с логом
    tar -czf backup.tar.gz /data > backup.log 2>&1

    # Проверка доступности сервера
    ping -c 1 google.com > /dev/null 2>&1 && echo "Online" || echo "Offline"

    # Чтение конфига в переменную
    config=$(< /etc/config.conf)

    # Многострочный ввод в команду
    grep "error" << EOF
    строка1
    строка2 с error
    строка3
    EOF

Специальные конструкции bash:
    # Exec для постоянного перенаправления
    exec > log.txt 2>&1  # все последующие команды будут писать в log.txt

    # Перенаправление в сокет
    echo "data" > /dev/tcp/host/port 2>/dev/null

    # Здесь-строки с переменными
    var="значение"
    cat <<< "$var"

Ошибки и решения:
    # Неправильно - пробелы важны!
    команда>file.txt     # Ошибка: команда>file.txt: команда не найдена
    команда >file.txt    # Правильно

    # Перенаправление через eval
    redirect="> file.txt"
    eval echo "test" $redirect

Встроенные файловые дескрипторы:
/dev/fd/0, /dev/fd/1, /dev/fd/2 — алиасы для stdin, stdout, stderr
