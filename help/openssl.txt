Инструкция по openssl

Информация и версия:
openssl version — версия OpenSSL
openssl version -a — подробная информация
openssl help — справка
openssl list -commands — список команд
openssl list -digest-algorithms — алгоритмы хеширования
openssl list -cipher-algorithms — алгоритмы шифрования

Хеширование:
openssl dgst -md5 файл — MD5 хеш
openssl dgst -sha1 файл — SHA1 хеш
openssl dgst -sha256 файл — SHA256 хеш
openssl dgst -sha512 файл — SHA512 хеш

Генерация ключей:
openssl genrsa -out ключ.pem 2048 — RSA ключ 2048 бит
openssl genpkey -algorithm RSA -out ключ.pem -aes256 — RSA с шифрованием
openssl ecparam -name prime256v1 -genkey -out ключ.pem — EC ключ (ECDSA)
openssl genpkey -algorithm ED25519 -out ключ.pem — Ed25519 ключ

Сертификаты:
openssl req -new -x509 -key ключ.pem -out cert.pem -days 365 — самоподписанный сертификат
openssl req -new -key ключ.pem -out запрос.csr — запрос на сертификат (CSR)
openssl x509 -in cert.pem -text -noout — просмотр сертификата
openssl req -in запрос.csr -text -noout — просмотр CSR

Шифрование/дешифрование:
openssl enc -aes-256-cbc -salt -in файл.txt -out файл.enc — шифрование AES-256
openssl enc -aes-256-cbc -d -in файл.enc -out файл.txt — дешифрование AES-256
openssl enc -base64 -in файл.bin -out файл.b64 — base64 кодирование
openssl enc -base64 -d -in файл.b64 -out файл.bin — base64 декодирование

Алгоритмы шифрования:
-aes-256-cbc, -aes-256-gcm, -chacha20, -des3, -bf (blowfish)

Подписи:
openssl dgst -sha256 -sign ключ.pem -out подпись.sig файл.txt — подписать файл
openssl dgst -sha256 -verify pubkey.pem -signature подпись.sig файл.txt — проверить подпись

Проверка сертификатов:
openssl verify -CAfile ca.pem cert.pem — проверить сертификат
openssl s_client -connect хост:порт — проверить SSL соединение
openssl s_client -connect хост:порт -servername имя — с SNI

Пароли:
openssl passwd -1 пароль — хеш пароля (Unix crypt)
openssl passwd -salt XX пароль — хеш с указанной солью

Случайные данные:
openssl rand -base64 32 — 32 байта случайных данных в base64
openssl rand -hex 16 — 16 байт в hex
openssl rand -out random.bin 1024 — 1KB случайных данных в файл

Конвертация форматов:
openssl rsa -in ключ.pem -out ключ.der -outform DER — PEM → DER
openssl rsa -in ключ.der -inform DER -out ключ.pem — DER → PEM
openssl pkcs12 -export -in cert.pem -inkey ключ.pem -out cert.p12 — в PKCS#12
openssl pkcs12 -in cert.p12 -out cert.pem -nodes — из PKCS#12

Информация о ключах:
openssl rsa -in ключ.pem -text -noout — информация о RSA ключе
openssl ec -in ключ.pem -text -noout — информация о EC ключе
openssl pkey -in ключ.pem -text -noout — информация о любом ключе

DH параметры:
openssl dhparam -out dhparams.pem 2048 — сгенерировать DH параметры 2048 бит
openssl dhparam -in dhparams.pem -text -noout — просмотреть DH параметры

Проверка приватного ключа:
openssl rsa -in ключ.pem -check — проверить RSA ключ

Извлечение публичного ключа:
openssl rsa -in ключ.pem -pubout -out pubkey.pem — извлечь публичный RSA ключ
openssl ec -in ключ.pem -pubout -out pubkey.pem — извлечь публичный EC ключ

Создание CA:
    openssl genrsa -out ca.key 4096
    openssl req -new -x509 -days 3650 -key ca.key -out ca.crt

Подпись сертификата:
openssl x509 -req -in запрос.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out сертификат.crt -days 365

Проверка цепочки:
openssl verify -CAfile ca.crt -untrusted промежуточный.crt сертификат.crt

Хеш сертификата:
openssl x509 -in cert.pem -hash -noout — hash сертификата

Отпечаток:
openssl x509 -in cert.pem -fingerprint -sha256 -noout — SHA256 отпечаток

Примеры использования:
openssl rand -base64 32 — генерация безопасного токена
openssl s_client -connect google.com:443 -showcerts — получить сертификаты сайта
openssl aes-256-cbc -salt -pbkdf2 -in секретный.txt -out секретный.enc — шифрование с PBKDF2
openssl dgst -sha256 файл.iso — проверка целостности файла
openssl pkcs8 -topk8 -inform PEM -outform PEM -in ключ.pem -out ключ_pkcs8.pem -nocrypt — конвертировать в PKCS#8

Проверка SSL/TLS:
openssl s_client -connect сайт:443 -tls1_2 — проверить TLS 1.2
openssl s_client -connect сайт:443 -tls1_3 — проверить TLS 1.3

Создание пар ключей:
    openssl genpkey -algorithm RSA -out private.pem -pkeyopt rsa_keygen_bits:4096
    openssl pkey -in private.pem -pubout -out public.pem

Работа с CSR:
openssl req -new -newkey rsa:2048 -nodes -keyout server.key -out server.csr — создать ключ и CSR

Быстрое создание самоподписанного сертификата:
    openssl req -x509 -newkey rsa:4096 -keyout key.pem -out cert.pem -days 365 -nodes -subj "/CN=localhost"
    
Проверка приватности ключа:
openssl rsa -in private.key -check 2>/dev/null | head -1
