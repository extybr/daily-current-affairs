Инструкция по watch

Основные опции:
watch команда — выполнять команду каждые 2 секунды
watch -n интервал команда — установить интервал (секунды)
watch -d команда — выделять изменения
watch -t команда — скрыть заголовок (no-title)
watch -g команда — выйти при изменении вывода
watch -b — бипик при ошибке команды (beep)

Интервал:
watch -n 1 команда — каждую секунду
watch -n 0.5 команда — каждые 0.5 секунды
watch -n 60 команда — каждую минуту

Выделение изменений:
watch -d команда — выделять все изменения
watch -d=cumulative команда — выделять кумулятивные изменения
watch --differences[=permanent] — то же что -d

Формат вывода:
watch --no-title команда — без заголовка (аналог -t)
watch --color — интерпретировать ANSI цветовые коды
watch --no-color — не интерпретировать цвета

Прерывание:
Ctrl+C — выход из watch
Ctrl+Z — приостановить, затем fg для возобновления

Примеры:
watch date — смотреть текущее время
watch -n 1 date — обновлять время каждую секунду
watch -d ls -la — следить за изменениями файлов
watch -n 5 free -h — следить за памятью каждые 5 секунд
watch -t uptime — показывать uptime без заголовка
watch -d 'ps aux | grep nginx' — следить за nginx процессами
watch -n 1 'netstat -tulpn | grep :80' — следить за 80 портом
watch -g 'ls -l /tmp/lockfile' — выйти когда файл появится
watch -b 'test -f /tmp/file && echo "SUCCESS"' — бип если файл создан
watch -n 0.1 'cat /proc/interrupts' — быстрое обновление (100ms)
watch -d=cumulative 'netstat -an | grep ESTABLISHED' — кумулятивные изменения соединений

Мониторинг системы:
watch -n 1 'df -h /' — следить за свободным местом
watch -n 2 'vmstat 1 2' — статистика виртуальной памяти
watch -d 'cat /proc/loadavg' — следить за нагрузкой системы
watch -n 1 'tail -20 /var/log/syslog' — следить за логом
watch 'dmesg | tail -20' — следить за сообщениями ядра

Мониторинг процессов:
watch 'ps aux --sort=-%cpu | head -10' — топ-10 процессов по CPU
watch 'ps aux --sort=-%mem | head -10' — топ-10 по памяти

Сетевой мониторинг:
watch -n 1 'ss -tulpan' — активные соединения
watch -n 2 'ping -c 1 google.com' — пинг каждые 2 секунды
watch -d 'netstat -s' — статистика сети

Вывод в одну строку:
watch -n 1 'echo -n "Память: "; free -h | grep Mem | awk "{print \$3}/\\\$\{4\}"'

Мониторинг файлов:
watch -d 'ls -lt | head -20' — последние измененные файлы
watch -n 5 'du -sh /var/log/' — размер логов каждые 5 секунд

Без заголовка:
watch -t 'who' — кто в системе без заголовка

Цветной вывод:
watch --color 'ls --color=always -la' — с цветами от ls

Проверка ошибок:
watch -b 'ls /nonexistent' — бип при ошибке команды

Скрипты:
watch -n 10 ./monitor.sh — запускать скрипт каждые 10 секунд

Прецизионный интервал:
watch -n 0.1 команда — 100 миллисекунд (минимально обычно 0.1 или 0.2)

Выход при изменении:
watch -g 'stat -c %Y /tmp/file' — выйти при изменении времени модификации файла

Дополнительные опции:
--interval=секунды или -n секунды — установить интервал
--precise или -p — пытаться запускать точно по интервалу
--exec — выполнить команду через exec, а не через shell
--chgexit — выйти при изменении вывода (аналог -g)

Примеры с --exec:
watch --exec ls -la — выполнять ls напрямую

Точный тайминг:
watch -p -n 1 команда — точное выполнение каждую секунду

Практические сценарии:
watch -n 1 'echo "CPU: $(grep "cpu " /proc/stat | awk "{usage=(\$2+\$4)*100/(\$2+\$4+\$5)} END {print usage}")%"' — использование CPU
watch -d -n 2 'docker ps' — следить за Docker контейнерами

Ограничения:
    Минимальный интервал зависит от системы
    Команда выполняется в новом shell каждый раз
    watch сам потребляет ресурсы

Справка:
watch --help — показать справку
man watch — подробная документация
